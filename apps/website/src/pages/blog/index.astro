---
import { getCollection } from 'astro:content';
import PostCard from '../../components/PostCard.astro';
import "@tm9657/flow-like-ui/global.css";
import "../../styles/Blog.css";
import BlogLayout from '../../layouts/BlogLayout.astro';

const PAGE_SIZE = 10;
const page = Number(Astro.url.searchParams.get('page') ?? 1);

const all = (await getCollection('blog', ({ data }) => import.meta.env.PROD ? !data.draft : true))
  .sort((a,b) => b.data.date.getTime() - a.data.date.getTime());

const start = (page-1)*PAGE_SIZE;
const slice = all.slice(start, start+PAGE_SIZE);
const pageCount = Math.ceil(all.length / PAGE_SIZE);
---

<BlogLayout data={{ title: "Blog", description: "Latest blog posts", slug: "blog" }}>
    <main class="mx-auto max-w-3xl p-2 flex flex-grow flex-col items-start justify-start gap-4">
        <h1 class="mt-4!">Blog</h1>
        {slice.map(p => <PostCard entry={p} />)}
        {pageCount > 1 && (
            <nav class="mt-8 flex gap-2">
      {Array.from({length: pageCount}, (_,i) => i+1).map(i =>
        <a href={`/?page=${i}`} aria-current={i===page ? 'page' : undefined}>{i}</a>
    )}
    </nav>
  )}
</main>
</BlogLayout>
